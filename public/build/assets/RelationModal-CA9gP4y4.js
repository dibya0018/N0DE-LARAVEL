import{r as j,j as a,b as K}from"./app-BAYl1HSz.js";import{h as T}from"./moment-BLMuvzoS.js";import{g as M}from"./lexical-converter-4eQd3LVe.js";import{D as H,a as L,b as P,c as B,d as I}from"./dialog-DohomiSb.js";import{D as J}from"./data-table-DBeixPDt.js";import{B as V}from"./badge-QMdTmx3v.js";import{F as Z}from"./file-text-CWXDWnWc.js";/* empty css            */import"./index-DzNUrV5G.js";import"./button-BUWHkrIo.js";import"./utils-CSG-oG7g.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./input-CNhlXZJH.js";import"./table-BXEyF7RO.js";import"./pagination-DqjXBUBk.js";import"./chevron-left-CIVxo5Hh.js";import"./chevron-right-D6wPFmnq.js";import"./select-CN0qBbIi.js";import"./scroll-area-4-y7N4RV.js";import"./index-ClMuC-A5.js";import"./index-CC0gYkaS.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./index-47IHtonF.js";import"./tooltip-DsY4Q31h.js";import"./chevron-down-Cw2QYx2J.js";import"./check-B69XlBAf.js";import"./search-bar-CXlHkVVx.js";import"./checkbox-DM2FAlZO.js";import"./popover-BngHBur4.js";import"./label-cm5VjJbG.js";import"./date-picker-B4BjS-4b.js";import"./calendar-CA5vAzoc.js";import"./clock-B4VR18tN.js";import"./format-C_TaVLmE.js";import"./switch-DYMSKvXv.js";import"./loader-circle-GU8JMaLt.js";function Ue({isOpen:$,onClose:b,field:u,value:h,onSelect:N,projectId:k}){var A,D,w,_;const[r,F]=j.useState(null),[O,U]=j.useState(null),[c,m]=j.useState([]),Y=async()=>{var i,e,n;const s=k||u.project_id,o=(e=(i=u.options)==null?void 0:i.relation)==null?void 0:e.collection;if(!s||!o){console.error("Missing required parameters: project_id or relation collection");return}let t;if(typeof route=="function")try{t=route("projects.collections.content.getRelationCollection",{project:s,collection:o})}catch{t=`/projects/${s}/collections/${o}/content/relation-collection`}else t=`/projects/${s}/collections/${o}/content/relation-collection`;try{const d=await K.get(t);let x=(n=u.options)!=null&&n.includeDraft?"":"filter_status=published";U(`/projects/${s}/collections/${o}/content/search?${x}`),F(d.data)}catch(d){console.error("Failed to fetch relation collection:",d)}};j.useEffect(()=>{$&&Y(),h&&Array.isArray(h)?m(h):h&&m([h])},[$]);const E=()=>{const s=[{header:"Status",accessorKey:"status",sortable:!0,filter:{type:"select",options:[{label:"Draft",value:"draft"},{label:"Published",value:"published"}]},cell:o=>a.jsx(V,{variant:o.status==="published"?"default":"outline",className:o.status==="published"?"bg-green-600 hover:bg-green-700":"text-amber-600 border-amber-300",children:o.status==="published"?"Published":"Draft"})},{header:"Created",accessorKey:"created_at",sortable:!0,filter:{type:"date"},cell:o=>{var t;return a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{children:new Date(o.created_at).toLocaleString()}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",((t=o.creator)==null?void 0:t.name)||"Unknown"]})]})}},{header:"Updated",accessorKey:"updated_at",sortable:!0,filter:{type:"date"},cell:o=>{var t;return a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{children:new Date(o.updated_at).toLocaleString()}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["by ",((t=o.updater)==null?void 0:t.name)||"Unknown"]})]})}}];return r!=null&&r.fields&&(r==null?void 0:r.fields.length)>0&&(r==null?void 0:r.fields.filter(t=>{var i;return t.type!=="password"&&t.type!=="json"&&!((i=t.options)!=null&&i.hideInContentList)&&!t.parent_field_id})).forEach(t=>{s.push({header:t.label,accessorKey:t.name,sortable:!0,cell:i=>{var n,d,x,v,R;const e=i[t.name];if(e==null||e==="")return"-";if((n=t.options)!=null&&n.repeatable&&Array.isArray(e)){if(e.length===0)return"-";const p=e[0];return typeof p=="object"&&p!==null&&!Array.isArray(p)?`${e.length} item${e.length===1?"":"s"}`:`${String(p)}${e.length>1?` (+${e.length-1} more)`:""}`}switch(t.type){case"text":return typeof e=="string"&&e.length>30?`${e.substring(0,30)}...`:e;case"email":case"slug":return e;case"richtext":const p=M(e);return p.length>30?`${p.substring(0,30)}...`:p;case"longtext":return typeof e=="string"&&e.length>30?`${e.substring(0,30)}...`:e;case"date":if(!e)return"-";let S="YYYY-MM-DD"+((d=t.options)!=null&&d.includeTime?" HH:mm":"");return((x=t.options)==null?void 0:x.mode)==="range"?e.split(" - ").map(l=>T.parseZone(l).format(S)).join(" / "):T.parseZone(e).format(S);case"boolean":return e?"Yes":"No";case"enumeration":if(Array.isArray(e))return e.join(", ");if(typeof e=="string")try{const l=JSON.parse(e);if(Array.isArray(l))return l.join(", ")}catch{}return e;case"number":return e===null?"-":Number(e).toString();case"media":return e&&Array.isArray(e)?a.jsx("div",{className:"flex flex-wrap gap-1",children:e.map((l,y)=>a.jsx("div",{className:"w-8 h-8",children:l.thumbnail_url?a.jsx("img",{src:l.thumbnail_url,alt:"",className:"w-full h-full object-cover rounded"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center bg-muted rounded",children:a.jsx(Z,{className:"w-4 h-4"})})},y))}):"-";case"group":const g=Array.isArray(e)?e:e?[e]:[];if(g.length>0){if((v=t.options)!=null&&v.repeatable)return`${g.length} item${g.length===1?"":"s"}`;{const l=t.children||((R=r==null?void 0:r.fields)==null?void 0:R.filter(y=>y.parent_field_id===t.id))||[];if(l.length>0&&g[0]){const y=l[0],f=g[0][y.name];if(f!=null&&f!=="")return String(f).length>30?`${String(f).substring(0,30)}...`:String(f)}return"Group data"}}return"-";default:return typeof e=="object"&&e!==null&&!Array.isArray(e)?JSON.stringify(e):e}}})}),s};return a.jsx(H,{open:$,onOpenChange:b,children:a.jsxs(L,{className:"sm:max-w-6xl max-h-[90vh] overflow-y-auto",children:[a.jsxs(P,{children:[a.jsx(B,{}),a.jsx(I,{className:"sr-only"})]}),a.jsx("div",{className:"space-y-4 overflow-x-auto",children:r&&a.jsx(J,{columns:E(),searchRoute:O??"",pageName:`relation_${r==null?void 0:r.project_id}_${r==null?void 0:r.id}`,onRowClick:s=>{var t,i;if(((i=(t=u.options)==null?void 0:t.relation)==null?void 0:i.type)===1)N(s,(r==null?void 0:r.fields)||[]),b();else{const e=c.some(n=>typeof n=="object"?n.id===s.id:n===s.id);m(e?c.filter(n=>typeof n=="object"?n.id!==s.id:n!==s.id):[...c,s])}},selectable:!0,onSelectionChange:s=>{var o,t;if(((t=(o=u.options)==null?void 0:o.relation)==null?void 0:t.type)===1){const i=s.length>0?[s[s.length-1]]:[];m(i)}else m(s)},selectedItems:c,actions:((D=(A=u.options)==null?void 0:A.relation)==null?void 0:D.type)===1?c.length>0?[{label:"Select",onClick:()=>{N(c[0],(r==null?void 0:r.fields)||[]),b()}}]:[]:((_=(w=u.options)==null?void 0:w.relation)==null?void 0:_.type)===2?c.length>0?[{label:"Add Selected",onClick:()=>{N(c,(r==null?void 0:r.fields)||[]),b()}}]:[]:[]})})]})})}export{Ue as default};
