import{u as re,r as o,j as e,H as ae,b,t as r}from"./app-BAYl1HSz.js";import{A as oe}from"./app-layout-BEHjmAYT.js";import{U as ie}from"./layout-M7G46ZpH.js";import{B as n}from"./button-BUWHkrIo.js";import{I as L}from"./input-CNhlXZJH.js";import{D as E,a as F,b as M,c as _,d as A,e as I}from"./dialog-DohomiSb.js";import{L as U}from"./label-cm5VjJbG.js";import{I as R}from"./input-error-BN6HrjaN.js";import{D as ne}from"./data-table-DBeixPDt.js";import{P as le}from"./plus-WwBbC7Wx.js";import{E as ce}from"./eye-off-CfQCku61.js";import{E as me}from"./eye-qNAffJdW.js";/* empty css            */import"./utils-CSG-oG7g.js";import"./index-DzNUrV5G.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./tooltip-DsY4Q31h.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./dropdown-menu-zE5wHxoc.js";import"./index-CC0gYkaS.js";import"./index-ClMuC-A5.js";import"./index-CDr1GRbl.js";import"./user-BSjMmka3.js";import"./settings-Bhr0gP4l.js";import"./app-logo-icon-BrzWybGo.js";import"./index-B_2jjvkB.js";import"./folder-BjjgW9yE.js";import"./image-u2W-qx98.js";import"./globe-CUGWl2f4.js";import"./users-DJytDsFA.js";import"./key-BAlHmL0b.js";import"./download-DYCYjKDs.js";import"./layout-grid-DOI_FcEe.js";import"./chevron-right-D6wPFmnq.js";import"./heading-zKqXxHZB.js";import"./separator-DNWIp4wA.js";import"./table-BXEyF7RO.js";import"./pagination-DqjXBUBk.js";import"./chevron-left-CIVxo5Hh.js";import"./select-CN0qBbIi.js";import"./scroll-area-4-y7N4RV.js";import"./index-47IHtonF.js";import"./chevron-down-Cw2QYx2J.js";import"./check-B69XlBAf.js";import"./search-bar-CXlHkVVx.js";import"./checkbox-DM2FAlZO.js";import"./popover-BngHBur4.js";import"./date-picker-B4BjS-4b.js";import"./calendar-CA5vAzoc.js";import"./clock-B4VR18tN.js";import"./format-C_TaVLmE.js";import"./switch-DYMSKvXv.js";import"./loader-circle-GU8JMaLt.js";const de=[{title:"User Management",href:"/user-management/users"},{title:"Permissions",href:"/user-management/permissions"}];function xs(){var T;const l=re().props.userCan,[$,m]=o.useState(!1),[d,f]=o.useState(!1),[H,p]=o.useState(!1),[K,x]=o.useState(!1),[D,q]=o.useState(!1),[j,y]=o.useState(""),[v,c]=o.useState(!1),[z,C]=o.useState({}),[g,B]=o.useState([]),[G,w]=o.useState({}),O=o.useRef(null),u="/user-management/api/permissions",[h,N]=o.useState({id:0,name:""}),P=()=>{N({id:0,name:""}),C({})},J=()=>{P(),f(!1),m(!0)},S=()=>{m(!1),f(!1),P()},k=()=>{var s;(s=O.current)==null||s.fetchData()},Q=async s=>{var i,a;s.preventDefault(),c(!0),C({});try{if(d){const t=await b.put(`${u}/${h.id}`,h);r.success(t.data.message)}else{const t=await b.post(u,h);r.success(t.data.message)}m(!1),f(!1),P(),k()}catch(t){((i=t.response)==null?void 0:i.status)===422?C(t.response.data.errors):((a=t.response)==null?void 0:a.status)===401?r.error(t.response.data.error):r.error("An error occurred")}finally{c(!1)}},V=s=>{l.update_permissions&&(N({id:s.id,name:s.name}),f(!0),m(!0))},W=()=>{p(!0)},X=()=>{x(!0)},Y=async()=>{var s,i;c(!0);try{const a=await b.delete(`${u}/${h.id}`);r.success(a.data.message),p(!1),S(),k()}catch(a){((s=a.response)==null?void 0:s.status)===422?(r.error(a.response.data.error),p(!1)):((i=a.response)==null?void 0:i.status)===401?r.error(a.response.data.error):r.error(a.response.data.error)}finally{c(!1)}},Z=async()=>{var s,i,a;if(!j){r.error("Please enter your password to confirm deletion");return}c(!0),w({});try{const t=await b.post(`${u}/bulk-delete`,{ids:g.map(te=>te.id),password:j});r.success(t.data.message),x(!1),B([]),y(""),k()}catch(t){((s=t.response)==null?void 0:s.status)===422?t.response.data.errors?w(t.response.data.errors):t.response.data.error&&r.error(t.response.data.error):((i=t.response)==null?void 0:i.status)===401?r.error(t.response.data.error):((a=t.response)==null?void 0:a.status)===403?r.error("Invalid password"):r.error("An error occurred while deleting")}finally{c(!1)}},ee=[{header:"Name",accessorKey:"name",sortable:!0,filter:{type:"text",placeholder:"Filter by name..."}},{header:"Created At",accessorKey:"created_at",sortable:!0,filter:{type:"date",placeholder:"Filter by creation date..."},cell:s=>e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleString()})},{header:"Updated At",accessorKey:"updated_at",sortable:!0,filter:{type:"date",placeholder:"Filter by update date..."},cell:s=>e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.updated_at).toLocaleString()})}],se=[{label:"Delete Selected",onClick:X,variant:"destructive",show:l.delete_permissions&&g.length>0},{label:"Create Permission",onClick:J,variant:"default",icon:e.jsx(le,{className:"h-4 w-4"}),show:l.create_permissions}];return e.jsxs(oe,{breadcrumbs:de,children:[e.jsx(ae,{title:"Permissions"}),e.jsx(ie,{can:l,children:e.jsx("div",{className:"space-y-4",children:e.jsx(ne,{ref:O,columns:ee,searchPlaceholder:"Search permissions...",searchRoute:u,actions:se.filter(s=>s.show),selectable:l.delete_permissions,onSelectionChange:B,selectedItems:g,pageName:"permissions-table",onRowClick:V})})}),e.jsx(E,{open:$,onOpenChange:s=>{m(s),s||S()},children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsxs(_,{className:"flex justify-between items-center",children:[e.jsx("span",{children:d?"Edit Permission":"Create New Permission"}),d&&l.delete_permissions&&e.jsx(n,{variant:"destructive",size:"sm",onClick:W,children:"Delete"})]}),e.jsx(A,{className:"sr-only",children:d?"Update permission details below":"Fill in the form to create a new permission"})]}),e.jsxs("form",{onSubmit:Q,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"name",children:"Name"}),e.jsx(L,{id:"name",type:"text",value:h.name,onChange:s=>N(i=>({...i,name:s.target.value})),required:!0}),e.jsx(R,{message:z.name})]}),e.jsxs(I,{className:"pt-4 border-t",children:[e.jsx(n,{type:"submit",disabled:v,children:d?"Update Permission":"Create Permission"}),e.jsx(n,{type:"button",variant:"outline",onClick:S,children:"Cancel"})]})]})]})}),e.jsx(E,{open:H,onOpenChange:p,children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsx(_,{children:"Are you sure you want to delete this permission?"}),e.jsx(A,{children:"This action cannot be undone. The permission will be permanently deleted."})]}),e.jsxs(I,{children:[e.jsx(n,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:Y,disabled:v,children:"Delete Permission"})]})]})}),e.jsx(E,{open:K,onOpenChange:s=>{x(s),s||(y(""),w({}))},children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsxs(M,{children:[e.jsxs(_,{children:["Are you sure you want to delete ",g.length," permissions?"]}),e.jsx(A,{children:"This action cannot be undone. The selected permissions will be permanently deleted."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{htmlFor:"password",children:"Enter your password to confirm"}),e.jsxs("div",{className:"relative",children:[e.jsx(L,{id:"password",type:D?"text":"password",value:j,onChange:s=>y(s.target.value),placeholder:"Enter your password"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 flex items-center pr-3",onClick:()=>q(!D),children:D?e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(me,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx(R,{message:(T=G.password)==null?void 0:T[0]})]})}),e.jsxs(I,{children:[e.jsx(n,{variant:"outline",onClick:()=>{x(!1),y(""),w({})},children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:Z,disabled:v||!j,children:"Delete Permissions"})]})]})})]})}export{xs as default};
