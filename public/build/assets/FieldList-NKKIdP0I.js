import{r as m,j as e,U as k,b as te,a as ie}from"./app-BAYl1HSz.js";import{c as L}from"./utils-CSG-oG7g.js";import{C as ae,a as oe,b as de,d as le,c as ne}from"./card-CrMVoWAt.js";import{B as u}from"./button-BUWHkrIo.js";import{D as me,C as ce,P as pe}from"./dnd.esm-Bv3pd172.js";import{f as P,G as D,D as T,S as M,T as x,F as ue}from"./FieldFormModal-D_ECj-tu.js";import fe from"./AddFieldModal-qNduh36z.js";import{P as G}from"./plus-WwBbC7Wx.js";import{G as xe}from"./grip-vertical-CVrUASli.js";import{C as he}from"./chevron-down-Cw2QYx2J.js";import{C as ge}from"./chevron-right-D6wPFmnq.js";import{L as je}from"./layers-DN_3VWi5.js";import{C as O}from"./code-DWMjAwzg.js";import{I as B}from"./image-u2W-qx98.js";import{C as H}from"./clock-B4VR18tN.js";import{C as q}from"./calendar-CA5vAzoc.js";import{L as z,A as R}from"./list-ordered-CAJaYuK2.js";import{H as Y}from"./hash-CHX6eWTm.js";import{L as U}from"./lock-op3ureYo.js";import{A as V}from"./at-sign-C25L0n_H.js";import{L as I}from"./link-t6pPAohe.js";import{P as W}from"./pencil-D2bWwKqy.js";/* empty css            */import"./extends-CF3RwP-h.js";import"./dialog-DohomiSb.js";import"./index-DzNUrV5G.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./input-CNhlXZJH.js";import"./label-cm5VjJbG.js";import"./textarea-BninraIe.js";import"./checkbox-DM2FAlZO.js";import"./index-47IHtonF.js";import"./index-WbFOJLSP.js";import"./check-B69XlBAf.js";import"./Select-b8uBCLur.js";import"./floating-ui.dom-DtF1XweH.js";import"./alert-dialog-rwDNo7n6.js";import"./scroll-area-4-y7N4RV.js";import"./index-ClMuC-A5.js";import"./radio-group-CThl2yM6.js";import"./index-CDr1GRbl.js";import"./index-CC0gYkaS.js";import"./input-error-BN6HrjaN.js";function cs({projectId:h,collectionId:g,initialFields:f,onAddFieldClick:J,collections:N,can:n}){const[p,j]=m.useState([...f].sort((s,r)=>(s.order??0)-(r.order??0))),[K,_]=m.useState(!1),[d,y]=m.useState(null),[Q,v]=m.useState(!1),[X,b]=m.useState(void 0),[w,A]=m.useState(new Set);m.useEffect(()=>{const s=[...f].sort((t,i)=>t.parent_field_id!==i.parent_field_id?t.parent_field_id?i.parent_field_id?t.parent_field_id-i.parent_field_id:1:-1:(t.order??0)-(i.order??0));j(s);const r=s.filter(t=>t.parent_field_id).reduce((t,i)=>{const l=i.parent_field_id;return t[l]||(t[l]=[]),t[l].push(i),t},{}),a=s.filter(t=>t.type==="group"&&!t.parent_field_id&&r[t.id]&&r[t.id].length>0).map(t=>t.id);a.length>0&&A(new Set(a))},[f]);const Z=async s=>{if(!s.destination)return;const r=Array.from(p),[a]=r.splice(s.source.index,1);r.splice(s.destination.index,0,a),j(r);try{await te.post(route("projects.collections.fields.reorder",{project:h,collection:g}),{fields:r.map((t,i)=>({id:t.id,order:i}))})}catch(t){console.error("Failed to update field order:",t),j(f)}},E=s=>{y(s),_(!0)},$=()=>{_(!1),y(null)},ee=s=>{b(s),v(!0)},F=()=>{v(!1),b(void 0),ie.reload({only:["collection"]})},se=s=>{const r=new Set(w);r.has(s)?r.delete(s):r.add(s),A(r)},re=p.filter(s=>!s.parent_field_id),C=p.filter(s=>s.parent_field_id).reduce((s,r)=>{const a=r.parent_field_id;return s[a]||(s[a]=[]),s[a].push(r),s},{});return Object.keys(C).forEach(s=>{C[Number(s)].sort((r,a)=>(r.order??0)-(a.order??0))}),e.jsxs(ae,{className:"flex-1",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Fields"}),e.jsx(le,{children:"Add, edit, and reorder fields to structure your collection's data"})]}),e.jsx(ne,{children:e.jsxs("div",{className:"space-y-4",children:[n.create_field&&e.jsxs(u,{className:"w-full",onClick:J,children:[e.jsx(G,{className:"mr-1"}),"Add Field"]}),e.jsx(me,{onDragEnd:Z,children:e.jsx(ce,{droppableId:"fields",children:s=>e.jsxs("div",{...s.droppableProps,ref:s.innerRef,className:"space-y-4",children:[re.map((r,a)=>{const t=P[r.type],i=r.type==="group",l=C[r.id]||[],S=w.has(r.id);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(pe,{draggableId:r.id.toString(),index:a,children:o=>e.jsxs("div",{ref:o.innerRef,...o.draggableProps,className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4 flex-1",children:[n.update_field&&e.jsx("div",{...o.dragHandleProps,className:"cursor-grab",children:e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})}),i&&e.jsx(u,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>se(r.id),children:S?e.jsx(he,{className:"h-4 w-4"}):e.jsx(ge,{className:"h-4 w-4"})}),e.jsx("div",{className:L("rounded-md p-2",(t==null?void 0:t.bg)||"bg-gray-400"),children:k.createElement({TextCursor:x,TextAlignLeft:R,Link:I,AtSign:V,Lock:U,SortNumericUp:Y,ListOrdered:z,CheckSquare:M,Tint:T,Calendar:q,CalendarCheck:H,PhotoVideo:B,ExchangeAlt:D,Code:O,Layers:je}[(t==null?void 0:t.icon)||"TextCursor"]||x,{className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:r.label}),e.jsx("div",{className:"text-sm text-muted-foreground select-all",children:r.name}),i&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[l.length," ",l.length===1?"field":"fields"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[i&&n.create_field&&e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>ee(r.id),children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Add Field"]}),n.update_field&&e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>E(r),children:e.jsx(W,{className:"h-4 w-4"})})]})]})}),i&&S&&l.length>0&&e.jsx("div",{className:"ml-8 space-y-2 border-l-2 pl-4",children:l.map(o=>{const c=P[o.type];return e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:L("rounded-md p-1.5",(c==null?void 0:c.bg)||"bg-gray-400"),children:k.createElement({TextCursor:x,TextAlignLeft:R,Link:I,AtSign:V,Lock:U,SortNumericUp:Y,ListOrdered:z,CheckSquare:M,Tint:T,Calendar:q,CalendarCheck:H,PhotoVideo:B,ExchangeAlt:D,Code:O}[(c==null?void 0:c.icon)||"TextCursor"]||x,{className:"text-white text-xs"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:o.label}),e.jsx("div",{className:"text-xs text-muted-foreground select-all",children:o.name})]})]}),n.update_field&&e.jsx(u,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>E(o),children:e.jsx(W,{className:"h-3 w-3"})})]},o.id)})})]},r.id)}),s.placeholder]})})})]})}),d&&e.jsx(ue,{isOpen:K,onClose:$,fieldType:d.type,collectionId:g,projectId:h,collections:N,collectionFields:p,parentFieldId:d.parent_field_id,can:n,editField:{...d,description:d.description??"",placeholder:d.placeholder??"",validations:d.validations??{required:{status:!1,message:""},unique:{status:!1,message:""},charcount:{status:!1,message:"",type:"Between",min:null,max:null}},options:d.options??{repeatable:!1,hideInContentList:!1,hiddenInAPI:!1,editor:{type:1},enumeration:{list:[]},multiple:!1,relation:{collection:null,type:1},slug:{field:null,readonly:!1},timepicker:!1,range:!1,date_format:"DD-MM-YYYY",hour_format:"HH:mm",multi_calendars:!1,media:{type:1}}}}),e.jsx(fe,{isOpen:Q,onClose:F,collectionId:g,projectId:h,onFieldCreated:F,collections:N,collectionFields:p,parentFieldId:X,can:n})]})}export{cs as default};
