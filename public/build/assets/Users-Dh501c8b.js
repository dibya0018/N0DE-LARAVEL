import{u as le,r as a,j as e,H as ne,b as D,t as o}from"./app-BAYl1HSz.js";import{g as ie}from"./utils-CSG-oG7g.js";import{A as de}from"./app-layout-BEHjmAYT.js";import{U as ce}from"./layout-M7G46ZpH.js";import{B as l}from"./button-BUWHkrIo.js";import{I as S}from"./input-CNhlXZJH.js";import{B as me}from"./badge-QMdTmx3v.js";import{D as I,a as _,b as A,c as R,d as L,e as K}from"./dialog-DohomiSb.js";import{L as f}from"./label-cm5VjJbG.js";import{S as pe}from"./Select-b8uBCLur.js";import{I as j}from"./input-error-BN6HrjaN.js";import{D as ue}from"./data-table-DBeixPDt.js";import{P as he}from"./plus-WwBbC7Wx.js";import{L as xe}from"./lock-op3ureYo.js";import{E as q}from"./eye-off-CfQCku61.js";import{E as z}from"./eye-qNAffJdW.js";import{K as fe}from"./key-round-DR82D8by.js";/* empty css            */import"./index-DzNUrV5G.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./tooltip-DsY4Q31h.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./dropdown-menu-zE5wHxoc.js";import"./index-CC0gYkaS.js";import"./index-ClMuC-A5.js";import"./index-CDr1GRbl.js";import"./user-BSjMmka3.js";import"./settings-Bhr0gP4l.js";import"./app-logo-icon-BrzWybGo.js";import"./index-B_2jjvkB.js";import"./folder-BjjgW9yE.js";import"./image-u2W-qx98.js";import"./globe-CUGWl2f4.js";import"./users-DJytDsFA.js";import"./key-BAlHmL0b.js";import"./download-DYCYjKDs.js";import"./layout-grid-DOI_FcEe.js";import"./chevron-right-D6wPFmnq.js";import"./heading-zKqXxHZB.js";import"./separator-DNWIp4wA.js";import"./extends-CF3RwP-h.js";import"./table-BXEyF7RO.js";import"./pagination-DqjXBUBk.js";import"./chevron-left-CIVxo5Hh.js";import"./select-CN0qBbIi.js";import"./scroll-area-4-y7N4RV.js";import"./index-47IHtonF.js";import"./chevron-down-Cw2QYx2J.js";import"./check-B69XlBAf.js";import"./search-bar-CXlHkVVx.js";import"./checkbox-DM2FAlZO.js";import"./popover-BngHBur4.js";import"./date-picker-B4BjS-4b.js";import"./calendar-CA5vAzoc.js";import"./clock-B4VR18tN.js";import"./format-C_TaVLmE.js";import"./switch-DYMSKvXv.js";import"./loader-circle-GU8JMaLt.js";const je=[{title:"User Management",href:"/user-management/users"},{title:"Users",href:"/user-management/users"}];function ks({roles:k}){var $;const c=le().props.userCan,[H,u]=a.useState(!1),[i,g]=a.useState(!1),[G,h]=a.useState(!1),[J,b]=a.useState(!1),[m,E]=a.useState(!1),[y,w]=a.useState(""),[U,p]=a.useState(!1),[v,F]=a.useState({}),[N,T]=a.useState([]),[Q,C]=a.useState({}),O=a.useRef(null),x="/user-management/api/users",[n,d]=a.useState({id:0,name:"",email:"",password:"",roles:[]}),P=()=>{d({id:0,name:"",email:"",password:"",roles:[]}),F({})},V=()=>{P(),g(!1),u(!0)},M=()=>{u(!1),g(!1),P()},B=()=>{var s;(s=O.current)==null||s.fetchData()},W=async s=>{var r;s.preventDefault(),p(!0),F({});try{if(i){const t=await D.put(`${x}/${n.id}`,n);o.success(t.data.message)}else{const t=await D.post(x,n);o.success(t.data.message)}u(!1),g(!1),P(),B()}catch(t){((r=t.response)==null?void 0:r.status)===422?F(t.response.data.errors):o.error("An error occurred")}finally{p(!1)}},X=s=>{c.update_users&&(d({id:s.id,name:s.name,email:s.email,password:"",roles:s.roles.map(r=>r.id)}),g(!0),u(!0))},Y=()=>{h(!0)},Z=()=>{b(!0)},ee=async()=>{var s;p(!0);try{const r=await D.delete(`${x}/${n.id}`);o.success(r.data.message),h(!1),M(),B()}catch(r){((s=r.response)==null?void 0:s.status)===422?(o.error(r.response.data.error),h(!1)):o.error(r.response.data.error)}finally{p(!1)}},se=async()=>{var s,r;if(!y){o.error("Please enter your password to confirm deletion");return}p(!0),C({});try{const t=await D.post(`${x}/bulk-delete`,{ids:N.map(oe=>oe.id),password:y});o.success(t.data.message),b(!1),T([]),w(""),B()}catch(t){((s=t.response)==null?void 0:s.status)===422?t.response.data.errors?C(t.response.data.errors):t.response.data.error&&o.error(t.response.data.error):((r=t.response)==null?void 0:r.status)===403?o.error("Invalid password"):o.error("An error occurred while deleting")}finally{p(!1)}},re=()=>{d(s=>({...s,password:ie()})),E(!0)},te=[{header:"Name",accessorKey:"name",sortable:!0,filter:{type:"text",placeholder:"Filter by name..."}},{header:"Email",accessorKey:"email",sortable:!0,filter:{type:"text",placeholder:"Filter by email..."}},{header:"Roles",accessorKey:"roles",filter:{type:"select",placeholder:"Filter by role...",options:k.map(s=>({label:s.name,value:s.id.toString()}))},cell:s=>e.jsx("div",{className:"flex flex-wrap gap-1",children:s.roles.map(r=>e.jsx(me,{variant:"secondary",children:r.name},r.id))})},{header:"Created At",accessorKey:"created_at",sortable:!0,filter:{type:"date",placeholder:"Filter by creation date..."},cell:s=>e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleString()})},{header:"Updated At",accessorKey:"updated_at",sortable:!0,filter:{type:"date",placeholder:"Filter by update date..."},cell:s=>e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.updated_at).toLocaleString()})}],ae=[{label:"Delete Selected",onClick:Z,variant:"destructive",show:c.delete_users&&N.length>0},{label:"Create User",onClick:V,variant:"default",icon:e.jsx(he,{className:"h-4 w-4"}),show:c.create_users}];return e.jsxs(de,{breadcrumbs:je,children:[e.jsx(ne,{title:"Users"}),e.jsx(ce,{can:c,children:e.jsx("div",{className:"space-y-4",children:e.jsx(ue,{ref:O,columns:te,searchPlaceholder:"Search users...",searchRoute:x,actions:ae.filter(s=>s.show),selectable:c.delete_users,onSelectionChange:T,selectedItems:N,pageName:"users-table",onRowClick:X})})}),e.jsx(I,{open:H,onOpenChange:s=>{u(s),s||M()},children:e.jsxs(_,{className:"sm:max-w-2xl",children:[e.jsxs(A,{children:[e.jsxs(R,{className:"flex justify-between items-center",children:[e.jsx("span",{children:i?"Edit User":"Create New User"}),i&&c.delete_users&&e.jsx(l,{variant:"destructive",size:"sm",onClick:Y,children:"Delete"})]}),e.jsx(L,{className:"sr-only",children:i?"Update user details below":"Fill in the form to create a new user"})]}),e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"name",children:"Name"}),e.jsx(S,{id:"name",type:"text",value:n.name,onChange:s=>d(r=>({...r,name:s.target.value})),required:!0}),e.jsx(j,{message:v.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"email",children:"Email"}),e.jsx(S,{id:"email",type:"email",value:n.email,onChange:s=>d(r=>({...r,email:s.target.value})),required:!0}),e.jsx(j,{message:v.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(f,{htmlFor:"password",children:["Password ",i&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"(leave blank to keep current)"})]}),e.jsxs("div",{className:"flex rounded-md",children:[e.jsx("span",{className:"inline-flex items-center px-3 rounded-l-md border border-r-0 border-input bg-muted text-muted-foreground text-sm",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(S,{id:"password",type:m?"text":"password",value:n.password,onChange:s=>d(r=>({...r,password:s.target.value})),required:!i,className:"rounded-none"}),e.jsx(l,{type:"button",variant:"ghost",size:"icon",className:"rounded-r-md rounded-l-none border border-l-0 border-input bg-muted text-muted-foreground hover:bg-muted",onClick:()=>E(!m),children:m?e.jsx(q,{className:"h-4 w-4"}):e.jsx(z,{className:"h-4 w-4"})}),e.jsx(l,{type:"button",variant:"ghost",size:"icon",className:"rounded-r-md border border-input bg-muted text-muted-foreground hover:bg-muted ml-2",onClick:re,children:e.jsx(fe,{className:"h-4 w-4"})})]}),e.jsx(j,{message:v.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"roles",children:"Roles"}),e.jsx(pe,{isMulti:!0,value:k.map(s=>({value:s.id,label:s.name})).filter(s=>n.roles.includes(s.value)),onChange:s=>{const r=s?s.map(t=>t.value):[];d(t=>({...t,roles:r}))},options:k.map(s=>({value:s.id,label:s.name})),placeholder:"Select roles..."}),e.jsx(j,{message:v.roles})]}),e.jsxs(K,{className:"pt-4 border-t",children:[e.jsx(l,{type:"submit",disabled:U,children:i?"Update User":"Create User"}),e.jsx(l,{type:"button",variant:"outline",onClick:M,children:"Cancel"})]})]})]})}),e.jsx(I,{open:G,onOpenChange:h,children:e.jsxs(_,{className:"sm:max-w-md",children:[e.jsxs(A,{children:[e.jsx(R,{children:"Are you sure you want to delete this user?"}),e.jsx(L,{children:"This action cannot be undone. The user will be permanently deleted."})]}),e.jsxs(K,{children:[e.jsx(l,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:ee,disabled:U,children:"Delete User"})]})]})}),e.jsx(I,{open:J,onOpenChange:s=>{b(s),s||(w(""),C({}))},children:e.jsxs(_,{className:"sm:max-w-md",children:[e.jsxs(A,{children:[e.jsxs(R,{children:["Are you sure you want to delete ",N.length," users?"]}),e.jsx(L,{children:"This action cannot be undone. The selected users will be permanently deleted."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{htmlFor:"password",children:"Enter your password to confirm"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"password",type:m?"text":"password",value:y,onChange:s=>w(s.target.value),placeholder:"Enter your password"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 flex items-center pr-3",onClick:()=>E(!m),children:m?e.jsx(q,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx(j,{message:($=Q.password)==null?void 0:$[0]})]})}),e.jsxs(K,{children:[e.jsx(l,{variant:"outline",onClick:()=>{b(!1),w(""),C({})},children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:se,disabled:U||!y,children:"Delete Users"})]})]})})]})}export{ks as default};
