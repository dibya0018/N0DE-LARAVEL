import{r as j,b as F,j as l}from"./app-BAYl1HSz.js";import T from"./FieldBase-Bf9Vt966.js";import{B as I}from"./button-BUWHkrIo.js";import w from"./RelationModal-CA9gP4y4.js";import{R as B}from"./relation-entries-table-D2aOOuck.js";import{P as U}from"./plus-WwBbC7Wx.js";import{T as k}from"./trash-CiO9M-2A.js";/* empty css            */import"./label-cm5VjJbG.js";import"./index-DRazXELc.js";import"./utils-CSG-oG7g.js";import"./input-error-BN6HrjaN.js";import"./moment-BLMuvzoS.js";import"./lexical-converter-4eQd3LVe.js";import"./dialog-DohomiSb.js";import"./index-DzNUrV5G.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-WjG9McFh.js";import"./data-table-DBeixPDt.js";import"./input-CNhlXZJH.js";import"./table-BXEyF7RO.js";import"./pagination-DqjXBUBk.js";import"./chevron-left-CIVxo5Hh.js";import"./chevron-right-D6wPFmnq.js";import"./select-CN0qBbIi.js";import"./scroll-area-4-y7N4RV.js";import"./index-ClMuC-A5.js";import"./index-CC0gYkaS.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./index-47IHtonF.js";import"./tooltip-DsY4Q31h.js";import"./chevron-down-Cw2QYx2J.js";import"./check-B69XlBAf.js";import"./search-bar-CXlHkVVx.js";import"./checkbox-DM2FAlZO.js";import"./popover-BngHBur4.js";import"./date-picker-B4BjS-4b.js";import"./calendar-CA5vAzoc.js";import"./clock-B4VR18tN.js";import"./format-C_TaVLmE.js";import"./switch-DYMSKvXv.js";import"./loader-circle-GU8JMaLt.js";import"./badge-QMdTmx3v.js";import"./file-text-CWXDWnWc.js";import"./dnd.esm-Bv3pd172.js";import"./extends-CF3RwP-h.js";function Tt({field:o,value:c,onChange:a,processing:y,errors:A,projectId:h}){var S,g,$,E;const[x,b]=j.useState(!1),[m,d]=j.useState([]),[M,R]=j.useState([]),N=(t,e)=>{var s,f;if(((f=(s=o.options)==null?void 0:s.relation)==null?void 0:f.type)===1){const i=typeof t=="object"?t.id:t;a(o,i),typeof t=="object"&&d([t])}else{let i=[];if(Array.isArray(t)){i=t.map(n=>typeof n=="object"?n.id:n);const p=t.filter(n=>typeof n=="object");d(p)}else i=[typeof t=="object"?t.id:t],typeof t=="object"&&d([t]);a(o,i)}const r=e.filter(i=>{var p;return!((p=i.options)!=null&&p.hideInContentList)&&i.type!=="password"&&i.type!=="json"});R(r)};return j.useEffect(()=>{var f,i;if(!c||m.length>0)return;let t=[];if(Array.isArray(c)?t=c:typeof c=="number"&&(t=[c]),t.length===0)return;const e=(i=(f=o.options)==null?void 0:f.relation)==null?void 0:i.collection;if(!e)return;const r=h||o.project_id;if(!r){console.error("Missing project ID for relation field");return}let s;if(typeof route=="function")try{s=route("projects.collections.content.find",{project:r,collection:e})}catch{s=`/projects/${r}/collections/${e}/content/find`}else s=`/projects/${r}/collections/${e}/content/find`;F.get(s,{params:{ids:t.join(",")}}).then(p=>{d(p.data);let n;if(typeof route=="function")try{n=route("projects.collections.content.getRelationCollection",{project:r,collection:e})}catch{n=`/projects/${r}/collections/${e}/content/relation-collection`}else n=`/projects/${r}/collections/${e}/content/relation-collection`;return F.get(n)}).then(p=>{const O=(p.data.fields||[]).filter(u=>{var C;return!((C=u.options)!=null&&C.hideInContentList)&&u.type!=="password"&&u.type!=="json"});R(O)}).catch(()=>{})},[c]),l.jsxs(T,{field:o,value:c,onChange:a,processing:y,errors:A,children:[l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(I,{type:"button",variant:"outline",disabled:y,onClick:()=>b(!0),children:[l.jsx(U,{className:"w-4 h-4"}),m.length>0?((g=(S=o.options)==null?void 0:S.relation)==null?void 0:g.type)===1?"Change Relation Entry":"Change Relation Entries":((E=($=o.options)==null?void 0:$.relation)==null?void 0:E.type)===1?"Select Relation Entry":"Select Relation Entries"]}),m.length>0&&l.jsxs(I,{type:"button",variant:"outline",disabled:y,onClick:()=>{d([]),a(o,[])},children:[l.jsx(k,{className:"w-4 h-4"}),"Clear Selected"]})]}),m.length>0&&l.jsx(B,{fields:M,entries:m,showStatus:!1,showCreated:!1,onOrderChange:t=>{var e,r;d(t),((r=(e=o.options)==null?void 0:e.relation)==null?void 0:r.type)===1?a(o,t.length>0?t[0].id:void 0):a(o,t.map(s=>s.id))}})]}),x&&l.jsx(w,{isOpen:x,onClose:()=>b(!1),field:o,value:m,onSelect:N,projectId:h})]})}export{Tt as default};
