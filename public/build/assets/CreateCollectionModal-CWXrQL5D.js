import{c as k,r as p,b as I,j as e}from"./app-BAYl1HSz.js";import{s as w}from"./utils-CSG-oG7g.js";import{B as y}from"./button-BUWHkrIo.js";import{D as R,a as q,b as T,c as J,d as U,e as A}from"./dialog-DohomiSb.js";import{I as g}from"./input-CNhlXZJH.js";import{L as l}from"./label-cm5VjJbG.js";import{I as h}from"./input-error-BN6HrjaN.js";import{S as B}from"./Select-b8uBCLur.js";import{C}from"./checkbox-DM2FAlZO.js";import{R as G,a as F}from"./radio-group-CThl2yM6.js";import{U as L}from"./upload-IcDaw6Sm.js";/* empty css            */import"./index-DzNUrV5G.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./extends-CF3RwP-h.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-47IHtonF.js";import"./index-WbFOJLSP.js";import"./check-B69XlBAf.js";import"./index-CDr1GRbl.js";import"./index-CC0gYkaS.js";import"./index-ClMuC-A5.js";function pe({open:o,onOpenChange:u,projectId:j,collection:r}){const{data:a,setData:t,post:N,put:S,processing:E,errors:x,reset:f,clearErrors:v}=k({name:(r==null?void 0:r.name)??"",slug:(r==null?void 0:r.slug)??"",template_id:"",is_singleton:!1,create_type:"manual",import_file:null},{forceFormData:!0}),n=p.useRef(null),[_,b]=p.useState([]);p.useEffect(()=>{!r&&o&&I.get(route("collection-templates.index")).then(s=>b(s.data)).catch(()=>b([]))},[o,r]),p.useEffect(()=>{if(a.name){const s=w(a.name);t("slug",s)}},[a.name]),p.useEffect(()=>{o?(t({name:(r==null?void 0:r.name)??"",slug:(r==null?void 0:r.slug)??"",template_id:"",is_singleton:!1,create_type:"manual",import_file:null}),n.current&&(n.current.value="")):(f(),v())},[o,r]),p.useEffect(()=>{o&&v()},[o]);const D=s=>{if(s.preventDefault(),r)S(route("projects.collections.update",[j,r.id]),{onSuccess:()=>{f(),u(!1)}});else if(a.create_type==="import"&&a.import_file)N(route("projects.collections.import",j),{forceFormData:!0,onSuccess:()=>{f(),u(!1)},onError:i=>{console.error("Import error:",i)}});else{const i=a.template_id?Number(a.template_id):null;t("template_id",i),N(route("projects.collections.store",j),{onSuccess:()=>{f(),u(!1)}})}};return e.jsx(R,{open:o,onOpenChange:u,children:e.jsxs(q,{className:"sm:max-w-2xl",children:[e.jsxs(T,{className:"border-b pb-3",children:[e.jsx(J,{children:r?"Edit Collection":"Create New Collection"}),e.jsx(U,{className:"sr-only",children:"Fill in the details below to create a new collection."})]}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[!r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"create_type",children:"Create Type"}),e.jsxs(G,{value:a.create_type,onValueChange:s=>{t("create_type",s),s==="manual"?(t("import_file",null),n.current&&(n.current.value="")):(t("name",""),t("slug",""),t("template_id",""))},className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-start space-x-2 p-4 rounded-md border border-dashed border-gray-600 dark:border-gray-400",children:[e.jsx(F,{value:"manual",id:"type_manual",className:"mt-1"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{htmlFor:"type_manual",className:"font-medium",children:"Create Manually"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Create a new collection from scratch."})]})]}),e.jsxs("div",{className:"flex items-start space-x-2 p-4 rounded-md border border-dashed border-gray-600 dark:border-gray-400",children:[e.jsx(F,{value:"import",id:"type_import",className:"mt-1"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{htmlFor:"type_import",className:"font-medium",children:"Import from File"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Import collection structure from JSON file."})]})]})]})]}),!r&&a.create_type==="import"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"import_file",children:"Import File (JSON)"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(g,{ref:n,id:"import_file",type:"file",accept:".json",onChange:async s=>{var d;const i=(d=s.target.files)==null?void 0:d[0];if(i){t("import_file",i);try{const c=await i.text(),m=JSON.parse(c);m.name&&t("name",m.name),m.slug&&t("slug",m.slug),m.is_singleton!==void 0&&t("is_singleton",m.is_singleton)}catch(c){console.error("Error reading file:",c)}}},className:"hidden"}),e.jsxs(y,{type:"button",variant:"outline",onClick:()=>{var s;return(s=n.current)==null?void 0:s.click()},className:"w-full sm:w-auto",children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),a.import_file?a.import_file.name:"Choose File"]})]}),a.import_file&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Selected: ",a.import_file.name]}),e.jsx(h,{message:x.import_file})]}),a.import_file&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Collection Name"}),e.jsx(g,{id:"name",value:a.name,onChange:s=>t("name",s.target.value),required:!0,placeholder:"Enter collection name"}),e.jsx(h,{message:x.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"slug",children:"Slug"}),e.jsx(g,{id:"slug",value:a.slug,onChange:s=>t("slug",s.target.value),required:!0,placeholder:"Enter collection slug"}),e.jsx(h,{message:x.slug})]}),e.jsxs("div",{className:"flex items-start space-x-2 p-4 rounded-md border border-dashed border-gray-600 dark:border-gray-400",children:[e.jsx(C,{id:"is_singleton",checked:!!a.is_singleton,onCheckedChange:s=>t("is_singleton",s===!0),className:"mt-1"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{htmlFor:"is_singleton",children:"Single record collection"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"A single record collection is a collection that can only have one record."})]})]})]})]}),(r||!r&&a.create_type==="manual")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Collection Name"}),e.jsx(g,{id:"name",value:a.name,onChange:s=>t("name",s.target.value),required:!0,placeholder:"Enter collection name"}),e.jsx(h,{message:x.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"slug",children:"Slug"}),e.jsx(g,{id:"slug",value:a.slug,onChange:s=>t("slug",s.target.value),required:!0,placeholder:"Enter collection slug"}),e.jsx(h,{message:x.slug})]}),!r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"template",children:"Template"}),e.jsx(B,{instanceId:"template-select",options:_.map(s=>({value:s.id.toString(),label:s.name})),isClearable:!0,isSearchable:!0,placeholder:"Select a template (optional)",value:_.map(s=>({value:s.id.toString(),label:s.name})).find(s=>s.value===a.template_id)||null,onChange:(s,i)=>{const d=s?s.value:"";if(t("template_id",d),d){const c=_.find(m=>m.id.toString()===d);c&&t("is_singleton",!!c.is_singleton)}}})]}),!r&&e.jsxs("div",{className:"flex items-start space-x-2 p-4 rounded-md border border-dashed border-gray-600 dark:border-gray-400",children:[e.jsx(C,{id:"is_singleton",checked:!!a.is_singleton,disabled:!!a.template_id,onCheckedChange:s=>t("is_singleton",s===!0),className:"mt-1"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(l,{htmlFor:"is_singleton",children:"Single record collection"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"A single record collection is a collection that can only have one record."})]})]})]}),e.jsxs(A,{className:"border-t pt-3",children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(y,{type:"submit",disabled:E,children:r?"Update Collection":a.create_type==="import"?"Import Collection":"Create Collection"})]})]})]})})}export{pe as default};
