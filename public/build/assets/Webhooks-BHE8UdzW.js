import{u as re,r as t,j as e,H as ne,a as ce,b as u,t as d}from"./app-BAYl1HSz.js";import{A as de}from"./app-layout-BEHjmAYT.js";import me from"./layout-DjpJEdUZ.js";import{B as i}from"./button-BUWHkrIo.js";import{D as he,a as pe,b as ue,c as xe,d as je,e as ge}from"./dialog-DohomiSb.js";import{I as x}from"./input-CNhlXZJH.js";import{L as r}from"./label-cm5VjJbG.js";import{I as n}from"./input-error-BN6HrjaN.js";import{S as F}from"./Select-b8uBCLur.js";import{S as Y}from"./switch-DYMSKvXv.js";import{H as fe}from"./heading-small-BlUNSpUE.js";import{A as ve,a as be,b as Ne,c as ye,d as ke,e as Se,f as Ce}from"./alert-dialog-rwDNo7n6.js";import{P as De}from"./plus-WwBbC7Wx.js";import{E as Z}from"./eye-qNAffJdW.js";import{E as we}from"./eye-off-CfQCku61.js";/* empty css            */import"./utils-CSG-oG7g.js";import"./index-DzNUrV5G.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./tooltip-DsY4Q31h.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./dropdown-menu-zE5wHxoc.js";import"./index-CC0gYkaS.js";import"./index-ClMuC-A5.js";import"./index-CDr1GRbl.js";import"./user-BSjMmka3.js";import"./settings-Bhr0gP4l.js";import"./app-logo-icon-BrzWybGo.js";import"./index-B_2jjvkB.js";import"./folder-BjjgW9yE.js";import"./image-u2W-qx98.js";import"./globe-CUGWl2f4.js";import"./users-DJytDsFA.js";import"./key-BAlHmL0b.js";import"./download-DYCYjKDs.js";import"./layout-grid-DOI_FcEe.js";import"./chevron-right-D6wPFmnq.js";import"./heading-zKqXxHZB.js";import"./separator-DNWIp4wA.js";import"./extends-CF3RwP-h.js";import"./index-47IHtonF.js";function bs({project:a}){var B,G,q,J,K,Q,X;const $=[{title:a.name,href:route("projects.show",a.id)},{title:"Settings",href:route("projects.settings.project",a.id)},{title:"Webhooks",href:route("projects.settings.webhooks",a.id)}],ee=re().props.userCan,[j,L]=t.useState([]),[se,I]=t.useState(!0),[te,c]=t.useState(!1),[m,H]=t.useState(null),[g,f]=t.useState(""),[T,v]=t.useState(""),[b,N]=t.useState(""),[z,h]=t.useState(""),[y,ae]=t.useState(!1),[M,k]=t.useState([]),S=["content.created","content.updated","content.trashed","content.deleted","content.published","content.unpublished","content.restored"],[_,C]=t.useState([S[0]]),[U,D]=t.useState(["cms"]),[O,w]=t.useState(!0),[R,E]=t.useState(!0),[l,A]=t.useState({}),[p,W]=t.useState(null),V=async()=>{I(!0);try{const s=await u.get(route("projects.settings.webhooks.index",[a.id]));L(s.data)}catch{d.error("Failed to load webhooks")}I(!1)};t.useEffect(()=>{V()},[]);const P=()=>{H(null),f(""),v(""),N(""),h(""),k([]),C([S[0]]),D(["cms"]),w(!0),E(!0),A({})},oe=async()=>{try{const s={name:g,description:T,url:b,secret:z,collection_ids:M,events:_,sources:U,payload:O,status:R};m?(await u.put(route("projects.settings.webhooks.update",[a.id,m.id]),s),d.success("Updated")):(await u.post(route("projects.settings.webhooks.store",a.id),s),d.success("Created")),c(!1),P(),V(),A({})}catch(s){s.response&&s.response.status===422?A(s.response.data.errors??{}):d.error("Failed to save")}},ie=async()=>{if(p)try{await u.delete(route("projects.settings.webhooks.destroy",[a.id,p.id])),L(j.filter(s=>s.id!==p.id)),d.success("Webhook deleted"),W(null),c(!1)}catch{d.error("Failed")}};return e.jsxs(de,{breadcrumbs:$,children:[e.jsx(ne,{title:"Webhooks settings"}),e.jsxs(me,{project:a,children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(fe,{title:"Webhooks"}),ee.access_webhooks_settings&&e.jsxs(i,{size:"sm",onClick:()=>{P(),c(!0)},children:[e.jsx(De,{className:"w-4 h-4 mr-1"})," New Webhook"]})]}),se?e.jsx("p",{className:"text-muted-foreground",children:"Loading..."}):j.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No webhooks yet."}):e.jsx("div",{className:"border rounded-md overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"URL"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Collections"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Events"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Sources"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Logs"})]})}),e.jsx("tbody",{children:j.map(s=>e.jsxs("tr",{className:"border-t cursor-pointer hover:bg-muted/50",onClick:()=>{var o;H(s),f(s.name),v(s.description??""),N(s.url),h(s.secret??""),k(((o=s.collections)==null?void 0:o.map(le=>le.id))??[]),C(s.events),D(s.sources),w(s.payload),E(s.status),c(!0)},children:[e.jsx("td",{className:"px-4 py-2",children:s.name}),e.jsx("td",{className:"px-4 py-2",children:s.url}),e.jsx("td",{className:"px-4 py-2",children:s.collections.map(o=>o.name).join(", ")}),e.jsx("td",{className:"px-4 py-2",children:s.events.join(", ")}),e.jsx("td",{className:"px-4 py-2",children:s.sources.join(", ")}),e.jsx("td",{className:"px-4 py-2",children:s.status?"Active":"Inactive"}),e.jsx("td",{className:"px-4 py-2",onClick:o=>o.stopPropagation(),children:e.jsx(i,{variant:"outline",size:"icon",onClick:()=>{ce.visit(route("projects.settings.webhooks.logs",[a.id,s.id]))},children:e.jsx(Z,{className:"w-4 h-4"})})})]},s.id))})]})})]}),e.jsx(he,{open:te,onOpenChange:s=>{s||(c(!1),P())},children:e.jsxs(pe,{className:"sm:max-w-3xl",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{children:m?"Edit Webhook":"Create Webhook"}),e.jsx(je,{children:"Configure your webhook details below."})]}),m&&e.jsx(i,{variant:"destructive",size:"sm",className:"ml-auto",onClick:()=>W(m),children:"Delete"})]})}),e.jsxs("div",{className:"space-y-2 max-h-[75vh] overflow-y-auto pr-2 px-1 pb-10",children:[e.jsxs("div",{children:[e.jsx(r,{children:"Name"}),e.jsx(x,{value:g,onChange:s=>f(s.target.value)}),e.jsx(n,{message:(B=l.name)==null?void 0:B[0]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Description"}),e.jsx(x,{value:T,onChange:s=>v(s.target.value)}),e.jsx(n,{message:(G=l.description)==null?void 0:G[0]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"URL"}),e.jsx(x,{value:b,onChange:s=>N(s.target.value),placeholder:"https://"}),e.jsx(n,{message:(q=l.url)==null?void 0:q[0]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Secret"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(x,{type:y?"text":"password",value:z,onChange:s=>h(s.target.value)}),e.jsx(i,{variant:"outline",size:"icon",onClick:()=>ae(!y),children:y?e.jsx(Z,{className:"w-4 h-4"}):e.jsx(we,{className:"w-4 h-4"})}),e.jsx(i,{variant:"secondary",size:"sm",onClick:()=>h(Math.random().toString(36).slice(2,18)+Math.random().toString(36).slice(2,18)),children:"Generate"})]}),e.jsx(n,{message:(J=l.secret)==null?void 0:J[0]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Collections"}),e.jsx(F,{isMulti:!0,options:(a.collections??[]).map(s=>({value:s.id,label:s.name})),value:(a.collections??[]).filter(s=>M.includes(s.id)).map(s=>({value:s.id,label:s.name})),onChange:s=>k(s.map(o=>o.value)),classNamePrefix:"rs"}),e.jsx(n,{message:(K=l.collection_ids)==null?void 0:K[0]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Events"}),e.jsx(F,{isMulti:!0,options:S.map(s=>({value:s,label:s})),value:_.map(s=>({value:s,label:s})),onChange:s=>C(s.map(o=>o.value)),classNamePrefix:"rs"}),e.jsx(n,{message:(Q=l.events)==null?void 0:Q[0]})]}),e.jsxs("div",{children:[e.jsx(r,{children:"Sources"}),e.jsx(F,{isMulti:!0,options:["cms","api"].map(s=>({value:s,label:s})),value:U.map(s=>({value:s,label:s})),onChange:s=>D(s.map(o=>o.value)),classNamePrefix:"rs"}),e.jsx(n,{message:(X=l.sources)==null?void 0:X[0]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:["Include Payload ",e.jsx(Y,{checked:O,onCheckedChange:w})]}),e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:["Active ",e.jsx(Y,{checked:R,onCheckedChange:E})]})]})]}),e.jsxs(ge,{children:[e.jsx(i,{variant:"secondary",onClick:()=>c(!1),children:"Close"}),e.jsx(i,{onClick:oe,disabled:!g||!b,children:"Save"})]})]})}),e.jsx(ve,{open:p!==null,onOpenChange:s=>{s||W(null)},children:e.jsxs(be,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Delete Webhook"}),e.jsx(ke,{children:"Are you sure you want to delete this webhook? This action cannot be undone."})]}),e.jsxs(Se,{children:[e.jsx(Ce,{children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:ie,children:"Delete"})]})]})})]})]})}export{bs as default};
