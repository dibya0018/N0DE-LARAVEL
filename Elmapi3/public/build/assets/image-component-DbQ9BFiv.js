import{r as u,j as l}from"./app-BAYl1HSz.js";import{M as B,d as V,u as Z,o as J,a as Q,P as k,y as I,$ as A,b as tt,_ as et,j as rt,z as ot,c as E,F as st,I as it,K as nt,U as at,e as lt,h as ct,S as F}from"./RichTextField-CrjV0zQv.js";import{B as ut}from"./button-BUWHkrIo.js";/* empty css            */import"./FieldBase-Bf9Vt966.js";import"./label-cm5VjJbG.js";import"./index-DRazXELc.js";import"./utils-CSG-oG7g.js";import"./input-error-BN6HrjaN.js";import"./tooltip-DsY4Q31h.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./index-WjG9McFh.js";import"./prism-Dqf3inl0.js";import"./separator-DNWIp4wA.js";import"./index-B_2jjvkB.js";import"./dialog-DohomiSb.js";import"./index-DzNUrV5G.js";import"./textarea-BninraIe.js";import"./list-ordered-CAJaYuK2.js";import"./save-BrDiTwid.js";import"./MediaFieldSelectModal-CtCYjuY2.js";import"./tabs-VLokmgZM.js";import"./index-CDr1GRbl.js";import"./index-CC0gYkaS.js";import"./index-ClMuC-A5.js";import"./dropdown-menu-zE5wHxoc.js";import"./search-bar-CXlHkVVx.js";import"./input-CNhlXZJH.js";import"./pagination-DqjXBUBk.js";import"./chevron-left-CIVxo5Hh.js";import"./chevron-right-D6wPFmnq.js";import"./alert-dialog-rwDNo7n6.js";import"./AssetGrid-2_pYCbtF.js";import"./card-CrMVoWAt.js";import"./checkbox-DM2FAlZO.js";import"./index-47IHtonF.js";import"./check-B69XlBAf.js";import"./badge-QMdTmx3v.js";import"./AssetDetailsModal-BtHtV5lE.js";import"./download-DYCYjKDs.js";import"./lock-op3ureYo.js";import"./copy-mrXhSjRK.js";import"./file-image-B6fjxKfq.js";import"./file-Da2ZVSrE.js";import"./file-text-CWXDWnWc.js";import"./AssetActionMenu-Dy7nZ14i.js";import"./ellipsis-vertical-Dhv4-4ce.js";import"./eye-qNAffJdW.js";import"./trash-CiO9M-2A.js";import"./AssetTable-CRXC0oAN.js";import"./table-BXEyF7RO.js";import"./format-C_TaVLmE.js";import"./AssetUploader-D4dsnDyd.js";import"./scroll-area-4-y7N4RV.js";import"./upload-IcDaw6Sm.js";import"./circle-alert-BCdqIib6.js";import"./image-u2W-qx98.js";import"./Select-b8uBCLur.js";import"./extends-CF3RwP-h.js";import"./calendar-CA5vAzoc.js";import"./plus-WwBbC7Wx.js";import"./layout-grid-DOI_FcEe.js";import"./chevron-down-Cw2QYx2J.js";import"./popover-BngHBur4.js";import"./align-center-TgbYJwzI.js";import"./link-t6pPAohe.js";import"./code-DWMjAwzg.js";import"./grip-vertical-CVrUASli.js";const G=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],Y=G[Math.floor(Math.random()*G.length)],mt=u.createContext({clientID:0,color:Y[1],isCollabActive:!1,name:Y[0],yjsDocMap:new Map});function pt(z,x){return u.useContext(mt)}function _(z,x,h){return Math.min(Math.max(z,x),h)}const r={east:1,north:8,south:2,west:4};function gt({onResizeStart:z,onResizeEnd:x,buttonRef:h,imageRef:R,maxWidth:D,editor:j,onEditAltText:N}){const b=u.useRef(null),v=u.useRef({priority:"",value:"default"}),g=u.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),m=j.getRootElement(),M=D||(m!==null?m.getBoundingClientRect().width-20:100),P=m!==null?m.getBoundingClientRect().height-20:100,S=100,T=100,i=t=>{const s=t===r.east||t===r.west,e=t===r.north||t===r.south,f=t&r.north&&t&r.west||t&r.south&&t&r.east,p=s?"ew":e?"ns":f?"nwse":"nesw";m!==null&&m.style.setProperty("cursor",`${p}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${p}-resize`,"important"),v.current.value=document.body.style.getPropertyValue("-webkit-user-select"),v.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},H=()=>{m!==null&&m.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",v.current.value,v.current.priority))},w=(t,s)=>{if(!j.isEditable())return;const e=R.current,f=b.current;if(e!==null&&f!==null){t.preventDefault();const{width:p,height:d}=e.getBoundingClientRect(),n=B(e),a=g.current;a.startWidth=p,a.startHeight=d,a.ratio=p/d,a.currentWidth=p,a.currentHeight=d,a.startX=t.clientX/n,a.startY=t.clientY/n,a.isResizing=!0,a.direction=s,i(s),z(),f.classList.add("touch-action-none"),e.style.height=`${d}px`,e.style.width=`${p}px`,document.addEventListener("pointermove",$),document.addEventListener("pointerup",L)}},$=t=>{const s=R.current,e=g.current,f=e.direction&(r.east|r.west),p=e.direction&(r.south|r.north);if(s!==null&&e.isResizing){const d=B(s);if(f&&p){let n=Math.floor(e.startX-t.clientX/d);n=e.direction&r.east?-n:n;const a=_(e.startWidth+n,S,M),W=a/e.ratio;s.style.width=`${a}px`,s.style.height=`${W}px`,e.currentHeight=W,e.currentWidth=a}else if(p){let n=Math.floor(e.startY-t.clientY/d);n=e.direction&r.south?-n:n;const a=_(e.startHeight+n,T,P);s.style.height=`${a}px`,e.currentHeight=a}else{let n=Math.floor(e.startX-t.clientX/d);n=e.direction&r.east?-n:n;const a=_(e.startWidth+n,S,M);s.style.width=`${a}px`,e.currentWidth=a}}},L=()=>{const t=R.current,s=g.current,e=b.current;if(t!==null&&e!==null&&s.isResizing){const f=s.currentWidth,p=s.currentHeight;s.startWidth=0,s.startHeight=0,s.ratio=0,s.startX=0,s.startY=0,s.currentWidth=0,s.currentHeight=0,s.isResizing=!1,e.classList.remove("touch-action-none"),H(),x(f,p),document.removeEventListener("pointermove",$),document.removeEventListener("pointerup",L)}};return l.jsxs("div",{ref:b,children:[l.jsx(ut,{className:"image-alt-text-button absolute bottom-1 left-1/2 -translate-x-1/2",ref:h,variant:"outline",onClick:N,children:"Edit Alt Text"}),l.jsx("div",{className:"image-resizer image-resizer-n bg-primary absolute -top-2.5 left-1/2 h-3 w-3 -translate-x-1/2 cursor-ns-resize",onPointerDown:t=>{w(t,r.north)}}),l.jsx("div",{className:"image-resizer image-resizer-ne bg-primary absolute -top-2.5 -right-2.5 h-3 w-3 cursor-nesw-resize",onPointerDown:t=>{w(t,r.north|r.east)}}),l.jsx("div",{className:"image-resizer image-resizer-e bg-primary absolute top-1/2 -right-2.5 h-3 w-3 -translate-y-1/2 cursor-ew-resize",onPointerDown:t=>{w(t,r.east)}}),l.jsx("div",{className:"image-resizer image-resizer-se bg-primary absolute -right-2.5 -bottom-2.5 h-3 w-3 cursor-nwse-resize",onPointerDown:t=>{w(t,r.south|r.east)}}),l.jsx("div",{className:"image-resizer image-resizer-s bg-primary absolute -bottom-2.5 left-1/2 h-3 w-3 -translate-x-1/2 cursor-ns-resize",onPointerDown:t=>{w(t,r.south)}}),l.jsx("div",{className:"image-resizer image-resizer-sw bg-primary absolute -bottom-2.5 -left-2.5 h-3 w-3 cursor-nesw-resize",onPointerDown:t=>{w(t,r.south|r.west)}}),l.jsx("div",{className:"image-resizer image-resizer-w bg-primary absolute top-1/2 -left-2.5 h-3 w-3 -translate-y-1/2 cursor-ew-resize",onPointerDown:t=>{w(t,r.west)}}),l.jsx("div",{className:"image-resizer image-resizer-nw bg-primary absolute -top-2.5 -left-2.5 h-3 w-3 cursor-nwse-resize",onPointerDown:t=>{w(t,r.north|r.west)}})]})}const U=V("RIGHT_CLICK_IMAGE_COMMAND");function dt({altText:z,className:x,imageRef:h,src:R,width:D,height:j,maxWidth:N,onError:b}){return l.jsx("img",{className:x||void 0,src:R,alt:z,ref:h,style:{height:j,maxWidth:N,width:D,display:"block"},onError:b,draggable:"false"})}function ht(){return l.jsx("img",{src:"",style:{height:200,opacity:.2,width:200},draggable:"false"})}function $e({src:z,altText:x,nodeKey:h,width:R,height:D,maxWidth:j,resizable:N}){const b=u.useRef(null),v=u.useRef(null),[g,m,M]=Z(h),[P,S]=u.useState(!1),{isCollabActive:T}=pt(),[i]=J(),[H,w]=u.useState(null),$=u.useRef(null),[L,t]=u.useState(!1),s=Q(),e=u.useCallback(c=>{const o=k();return g&&I(o)&&(c.preventDefault(),i.update(()=>{o.getNodes().forEach(C=>{A(C)&&C.remove()})})),!1},[i,g]),f=u.useCallback(c=>{const o=k(),y=v.current;return g&&I(o)&&o.getNodes().length===1&&y!==null&&y!==document.activeElement?(c.preventDefault(),y.focus(),!0):!1},[g]),p=u.useCallback(c=>v.current===c.target?(tt(null),i.update(()=>{m(!0);const o=i.getRootElement();o!==null&&o.focus()}),!0):!1,[i,m]),d=u.useCallback(c=>{const o=c;return P?!0:o.target===b.current?(o.shiftKey?m(!g):(M(),m(!0)),!0):!1},[P,g,m,M]),n=u.useCallback(c=>{i.getEditorState().read(()=>{const o=k();c.target.tagName==="IMG"&&et(o)&&o.getNodes().length===1&&i.dispatchCommand(U,c)})},[i]);u.useEffect(()=>{let c=!0;const o=i.getRootElement(),y=rt(i.registerUpdateListener(({editorState:C})=>{c&&w(C.read(()=>k()))}),i.registerCommand(ct,(C,K)=>($.current=K,!1),E),i.registerCommand(lt,d,E),i.registerCommand(U,d,E),i.registerCommand(at,C=>C.target===b.current?(C.preventDefault(),!0):!1,E),i.registerCommand(nt,e,E),i.registerCommand(it,e,E),i.registerCommand(st,f,E),i.registerCommand(ot,p,E));return o==null||o.addEventListener("contextmenu",n),()=>{c=!1,y(),o==null||o.removeEventListener("contextmenu",n)}},[M,i,P,g,h,e,f,p,d,n,m]);const a=()=>{const c=prompt("Enter alt text for the image:",x);c!==null&&i.update(()=>{const o=F(h);A(o)&&o.setAltText(c)})},W=(c,o)=>{setTimeout(()=>{S(!1)},200),i.update(()=>{const y=F(h);A(y)&&y.setWidthAndHeight(c,o)})},O=()=>{S(!0)},q=g&&I(H)&&!P,X=(g||P)&&s;return l.jsx(u.Suspense,{fallback:l.jsx("div",{children:"Loading image..."}),children:l.jsxs(l.Fragment,{children:[l.jsx("div",{draggable:q,className:"relative",children:L?l.jsx(ht,{}):l.jsx(dt,{className:`max-w-full cursor-default ${X?`${I(H)?"draggable cursor-grab active:cursor-grabbing":""} focused ring-primary ring-2 ring-offset-2`:null}`,src:z,altText:x,imageRef:b,width:R,height:D,maxWidth:j,onError:()=>t(!0)})}),N&&I(H)&&X&&l.jsx(gt,{editor:i,buttonRef:v,imageRef:b,maxWidth:j,onResizeStart:O,onResizeEnd:W,onEditAltText:a})]})})}export{U as RIGHT_CLICK_IMAGE_COMMAND,$e as default};
