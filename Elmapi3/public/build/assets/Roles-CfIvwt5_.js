import{u as de,r as l,j as e,H as me,b as D,t as n}from"./app-BAYl1HSz.js";import{A as pe}from"./app-layout-BEHjmAYT.js";import{U as he,S as ue}from"./layout-M7G46ZpH.js";import{c as xe,B as m}from"./button-BUWHkrIo.js";import{I as q}from"./input-CNhlXZJH.js";import{B as fe}from"./badge-QMdTmx3v.js";import{D as I,a as O,b as B,c as U,d as $,e as K}from"./dialog-DohomiSb.js";import{L as S}from"./label-cm5VjJbG.js";import{C as E}from"./checkbox-DM2FAlZO.js";import{I as z}from"./input-error-BN6HrjaN.js";import{D as je}from"./data-table-DBeixPDt.js";import{P as ye}from"./plus-WwBbC7Wx.js";import{K as ge}from"./key-BAlHmL0b.js";import{U as V}from"./users-DJytDsFA.js";import{E as we}from"./eye-off-CfQCku61.js";import{E as be}from"./eye-qNAffJdW.js";/* empty css            */import"./utils-CSG-oG7g.js";import"./index-DzNUrV5G.js";import"./index-D0mva12j.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./tooltip-DsY4Q31h.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./dropdown-menu-zE5wHxoc.js";import"./index-CC0gYkaS.js";import"./index-ClMuC-A5.js";import"./index-CDr1GRbl.js";import"./user-BSjMmka3.js";import"./settings-Bhr0gP4l.js";import"./app-logo-icon-BrzWybGo.js";import"./index-B_2jjvkB.js";import"./folder-BjjgW9yE.js";import"./image-u2W-qx98.js";import"./globe-CUGWl2f4.js";import"./download-DYCYjKDs.js";import"./layout-grid-DOI_FcEe.js";import"./chevron-right-D6wPFmnq.js";import"./heading-zKqXxHZB.js";import"./separator-DNWIp4wA.js";import"./index-47IHtonF.js";import"./check-B69XlBAf.js";import"./table-BXEyF7RO.js";import"./pagination-DqjXBUBk.js";import"./chevron-left-CIVxo5Hh.js";import"./select-CN0qBbIi.js";import"./scroll-area-4-y7N4RV.js";import"./chevron-down-Cw2QYx2J.js";import"./search-bar-CXlHkVVx.js";import"./popover-BngHBur4.js";import"./date-picker-B4BjS-4b.js";import"./calendar-CA5vAzoc.js";import"./clock-B4VR18tN.js";import"./format-C_TaVLmE.js";import"./switch-DYMSKvXv.js";import"./loader-circle-GU8JMaLt.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M5 7 3 5",key:"1yys58"}],["path",{d:"M9 6V3",key:"1ptz9u"}],["path",{d:"m13 7 2-2",key:"1w3vmq"}],["circle",{cx:"9",cy:"13",r:"3",key:"1mma13"}],["path",{d:"M11.83 12H20a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2.17",key:"2frwzc"}],["path",{d:"M16 16h2",key:"dnq2od"}]],Ne=xe("Projector",ve),Ce=[{title:"User Management",href:"/user-management/users"},{title:"Roles",href:"/user-management/roles"}];function Rs({permissionGroups:u}){var H;const p=de().props.userCan,[J,x]=l.useState(!1),[f,w]=l.useState(!1),[Q,j]=l.useState(!1),[W,b]=l.useState(!1),[P,X]=l.useState(!1),[v,N]=l.useState(""),[R,h]=l.useState(!1),[Y,M]=l.useState({}),[C,L]=l.useState([]),[Z,k]=l.useState({}),T=l.useRef(null),y="/user-management/api/roles",[i,d]=l.useState({id:0,name:"",permissions:[]}),_=()=>{d({id:0,name:"",permissions:[]}),M({})},G=()=>{_(),w(!1),x(!0)},A=()=>{x(!1),w(!1),_()},F=()=>{var s;(s=T.current)==null||s.fetchData()},ee=async s=>{var t;s.preventDefault(),h(!0),M({});try{if(f){const r=await D.put(`${y}/${i.id}`,i);n.success(r.data.message)}else{const r=await D.post(y,i);n.success(r.data.message)}x(!1),w(!1),_(),F()}catch(r){((t=r.response)==null?void 0:t.status)===422?M(r.response.data.errors):n.error("An error occurred")}finally{h(!1)}},se=s=>{var t;p.update_roles&&(d({id:s.id,name:s.name,permissions:((t=s.permissions)==null?void 0:t.map(r=>r.name))||[]}),w(!0),x(!0))},re=()=>{j(!0)},te=()=>{b(!0)},ae=async()=>{var s;h(!0);try{const t=await D.delete(`${y}/${i.id}`);n.success(t.data.message),j(!1),A(),F()}catch(t){((s=t.response)==null?void 0:s.status)===422?(n.error(t.response.data.error),j(!1)):n.error(t.response.data.error)}finally{h(!1)}},oe=async()=>{var s,t;if(!v){n.error("Please enter your password to confirm deletion");return}h(!0),k({});try{const r=await D.post(`${y}/bulk-delete`,{ids:C.map(a=>a.id),password:v});n.success(r.data.message),b(!1),L([]),N(""),F()}catch(r){((s=r.response)==null?void 0:s.status)===422?r.response.data.errors?k(r.response.data.errors):r.response.data.error&&n.error(r.response.data.error):((t=r.response)==null?void 0:t.status)===403?n.error("Invalid password"):n.error("An error occurred while deleting")}finally{h(!1)}},le=(s,t,r)=>{d(a=>{const o=[...a.permissions];return r?t.forEach(c=>{o.includes(c)||o.push(c)}):t.forEach(c=>{const g=o.indexOf(c);g>-1&&o.splice(g,1)}),{...a,permissions:o}})},ne=s=>{d(t=>{const r=[...t.permissions];return s?u.projects.forEach(a=>{r.includes(a.permission)||r.push(a.permission)}):u.projects.forEach(a=>{const o=r.indexOf(a.permission);o>-1&&r.splice(o,1)}),{...t,permissions:r}})},ie=[{header:"Name",accessorKey:"name",sortable:!0,filter:{type:"text",placeholder:"Filter by name..."}},{header:"Permissions",accessorKey:"permissions",cell:s=>{var t;return e.jsx("div",{className:"flex flex-wrap gap-1",children:e.jsxs(fe,{variant:"secondary",children:[((t=s.permissions)==null?void 0:t.length)||0," permissions"]})})}},{header:"Created At",accessorKey:"created_at",sortable:!0,filter:{type:"date",placeholder:"Filter by creation date..."},cell:s=>e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleString()})},{header:"Updated At",accessorKey:"updated_at",sortable:!0,filter:{type:"date",placeholder:"Filter by update date..."},cell:s=>e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(s.updated_at).toLocaleString()})}],ce=[{label:"Delete Selected",onClick:te,variant:"destructive",show:p.delete_roles&&C.length>0},{label:"Create Role",onClick:G,variant:"default",icon:e.jsx(ye,{className:"h-4 w-4"}),show:p.create_roles}];return e.jsxs(pe,{breadcrumbs:Ce,children:[e.jsx(me,{title:"Roles"}),e.jsx(he,{can:p,children:e.jsx("div",{className:"space-y-4",children:e.jsx(je,{ref:T,columns:ie,searchPlaceholder:"Search roles...",searchRoute:y,actions:ce.filter(s=>s.show),selectable:p.delete_roles,onSelectionChange:L,selectedItems:C,pageName:"roles-table",onRowClick:se})})}),e.jsx(I,{open:J,onOpenChange:s=>{x(s),s||A()},children:e.jsxs(O,{className:"sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(B,{children:[e.jsxs(U,{className:"flex justify-between items-center",children:[e.jsx("span",{children:f?"Edit Role":"Create New Role"}),f&&p.delete_roles&&e.jsx(m,{variant:"destructive",size:"sm",onClick:re,children:"Delete"})]}),e.jsx($,{className:"sr-only",children:f?"Update role details below":"Fill in the form to create a new role"})]}),e.jsxs("form",{onSubmit:ee,className:"space-y-4 max-h-[60vh] overflow-y-auto px-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"name",children:"Name"}),e.jsx(q,{id:"name",type:"text",value:i.name,onChange:s=>d(t=>({...t,name:s.target.value})),required:!0,className:"max-w-md"}),e.jsx(z,{message:Y.name})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3",children:u.groups.map(s=>{const t={Users:V,Shield:ue,Key:ge}[s.icon]||V;return e.jsxs("div",{className:"p-4 border rounded-lg bg-card hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium",children:s.label})]}),e.jsx(E,{checked:s.permissions.every(r=>i.permissions.includes(r)),onCheckedChange:r=>le(s.group,s.permissions,r)})]}),e.jsx("div",{className:"space-y-2 pl-6",children:s.permissions.map(r=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:`${r}`,checked:i.permissions.includes(`${r}`),onCheckedChange:a=>{d(o=>{const c=[...o.permissions];if(a)c.push(r);else{const g=c.indexOf(r);g>-1&&c.splice(g,1)}return{...o,permissions:c}})}}),e.jsx(S,{htmlFor:`${r}`,className:"text-sm",children:r.charAt(0).toUpperCase()+r.slice(1)})]},r))})]},s.group)})}),e.jsxs("div",{className:"p-4 border rounded-lg bg-card hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-medium",children:"Projects"})]}),e.jsx(E,{checked:u.projects.every(s=>i.permissions.includes(s.permission)),onCheckedChange:s=>ne(s)})]}),e.jsx("div",{className:"space-y-2 pl-6",children:u.projects.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{id:s.permission,checked:i.permissions.includes(s.permission),onCheckedChange:t=>{d(r=>{const a=[...r.permissions];if(t)a.push(s.permission);else{const o=a.indexOf(s.permission);o>-1&&a.splice(o,1)}return{...r,permissions:a}})}}),e.jsx(S,{htmlFor:s.permission,className:"text-sm",children:s.name})]},s.permission))})]})]}),e.jsxs(K,{className:"pt-4 border-t",children:[e.jsx(m,{type:"submit",disabled:R,children:f?"Update Role":"Create Role"}),e.jsx(m,{type:"button",variant:"outline",onClick:A,children:"Cancel"})]})]})]})}),e.jsx(I,{open:Q,onOpenChange:j,children:e.jsxs(O,{className:"sm:max-w-md",children:[e.jsxs(B,{children:[e.jsx(U,{children:"Are you sure you want to delete this role?"}),e.jsx($,{children:"This action cannot be undone. The role will be permanently deleted."})]}),e.jsxs(K,{children:[e.jsx(m,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:ae,disabled:R,children:"Delete Role"})]})]})}),e.jsx(I,{open:W,onOpenChange:s=>{b(s),s||(N(""),k({}))},children:e.jsxs(O,{className:"sm:max-w-md",children:[e.jsxs(B,{children:[e.jsxs(U,{children:["Are you sure you want to delete ",C.length," roles?"]}),e.jsx($,{children:"This action cannot be undone. The selected roles will be permanently deleted."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(S,{htmlFor:"password",children:"Enter your password to confirm"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{id:"password",type:P?"text":"password",value:v,onChange:s=>N(s.target.value),placeholder:"Enter your password"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 flex items-center pr-3",onClick:()=>X(!P),children:P?e.jsx(we,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(be,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx(z,{message:(H=Z.password)==null?void 0:H[0]})]})}),e.jsxs(K,{children:[e.jsx(m,{variant:"outline",onClick:()=>{b(!1),N(""),k({})},children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:oe,disabled:R||!v,children:"Delete Roles"})]})]})})]})}export{Rs as default};
