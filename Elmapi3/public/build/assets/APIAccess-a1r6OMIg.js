import{u as G,r as a,j as e,H as B,t as n,b as h}from"./app-BAYl1HSz.js";import{A as R,a as U,b as Y,c as $,d as q,e as J,f as K}from"./alert-dialog-rwDNo7n6.js";import{A as M}from"./app-layout-BEHjmAYT.js";import Q from"./layout-DjpJEdUZ.js";import{H as N}from"./heading-small-BlUNSpUE.js";import{B as i}from"./button-BUWHkrIo.js";import{I as u}from"./input-CNhlXZJH.js";import{L as y}from"./label-cm5VjJbG.js";import{S as v}from"./separator-DNWIp4wA.js";import{S as V}from"./switch-DYMSKvXv.js";import{D as W,a as X,b as Z,c as ee,d as se,e as te}from"./dialog-DohomiSb.js";import{C as w}from"./copy-mrXhSjRK.js";import{P as ie}from"./plus-WwBbC7Wx.js";import{P as ae}from"./pencil-D2bWwKqy.js";import{T as le}from"./trash-2-DxLslLPH.js";/* empty css            */import"./index-D0mva12j.js";import"./utils-CSG-oG7g.js";import"./index-DzNUrV5G.js";import"./Combination-DBQolvko.js";import"./index-DRazXELc.js";import"./index-WjG9McFh.js";import"./tooltip-DsY4Q31h.js";import"./index-DU1cekCd.js";import"./floating-ui.dom-DtF1XweH.js";import"./index-WbFOJLSP.js";import"./dropdown-menu-zE5wHxoc.js";import"./index-CC0gYkaS.js";import"./index-ClMuC-A5.js";import"./index-CDr1GRbl.js";import"./user-BSjMmka3.js";import"./settings-Bhr0gP4l.js";import"./app-logo-icon-BrzWybGo.js";import"./index-B_2jjvkB.js";import"./folder-BjjgW9yE.js";import"./image-u2W-qx98.js";import"./globe-CUGWl2f4.js";import"./users-DJytDsFA.js";import"./key-BAlHmL0b.js";import"./download-DYCYjKDs.js";import"./layout-grid-DOI_FcEe.js";import"./chevron-right-D6wPFmnq.js";import"./heading-zKqXxHZB.js";import"./index-47IHtonF.js";function Ve({project:t,tokens:P}){const _=[{title:t.name,href:route("projects.show",t.id)},{title:"Settings",href:route("projects.settings.project",t.id)},{title:"API Access",href:route("projects.settings.api-access",t.id)}],C=G().props.userCan,[r,j]=a.useState(P),[A,I]=a.useState(t.public_api),[E,c]=a.useState(!1),[d,T]=a.useState(null),[o,g]=a.useState(""),[l,m]=a.useState(["read"]),[p,D]=a.useState(null),[x,k]=a.useState(null),S=`${window.location.origin}/api`,f=s=>{navigator.clipboard.writeText(s),n.success("Copied to clipboard")},F=async()=>{try{const s=await h.post(route("projects.settings.toggle-public",t.id));I(s.data.public_api),n.success("Public API setting updated")}catch{n.error("Failed")}},b=()=>{T(null),D(null),g(""),m(["read"])},H=async()=>{try{if(d)await h.put(route("projects.settings.tokens.update",[t.id,d.id]),{name:o,abilities:l}),j(r.map(s=>s.id===d.id?{...s,name:o,abilities:l}:s)),n.success("Token updated"),c(!1),b();else{const s=await h.post(route("projects.settings.tokens.create",t.id),{name:o,abilities:l});j([...r,{id:s.data.token_id,name:o,abilities:l,created_at:new Date().toISOString()}]),D(s.data.token)}}catch{n.error("Failed to save token")}},O=async()=>{if(x!==null){try{await h.delete(route("projects.settings.tokens.delete",[t.id,x])),j(r.filter(s=>s.id!==x)),n.success("Token deleted")}catch{n.error("Failed")}k(null)}};return e.jsxs(M,{breadcrumbs:_,children:[e.jsx(B,{title:"API Access settings"}),e.jsx(Q,{project:t,children:e.jsxs("div",{className:"space-y-6 max-w-2xl",children:[e.jsxs("div",{children:[e.jsx(N,{title:"Project ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{readOnly:!0,value:t.uuid}),e.jsx(i,{variant:"outline",onClick:()=>f(t.uuid),children:e.jsx(w,{className:"w-4 h-4"})})]})]}),e.jsx(v,{}),e.jsxs("div",{children:[e.jsx(N,{title:"Content API Endpoint"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{readOnly:!0,value:S}),e.jsx(i,{variant:"outline",onClick:()=>f(S),children:e.jsx(w,{className:"w-4 h-4"})})]})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{htmlFor:"public_toggle",children:A?"Disable Public GET access":"Enable Public GET access"}),e.jsx(V,{id:"public_toggle",checked:A,onCheckedChange:F})]}),e.jsx(v,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(N,{title:"Access Tokens"}),C.access_api_access_settings&&e.jsxs(i,{size:"sm",onClick:()=>{b(),c(!0)},children:[e.jsx(ie,{className:"w-4 h-4 mr-1"})," Create Token"]})]}),e.jsx("div",{className:"border rounded-md mt-4 ",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Name"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Abilities"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[r.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:s.name}),e.jsx("td",{className:"px-4 py-2",children:s.abilities.join(", ")}),e.jsx("td",{className:"px-4 py-2 text-right",children:C.access_api_access_settings&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>{T(s),g(s.name),m(s.abilities),c(!0)},children:e.jsx(ae,{className:"w-4 h-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>k(s.id),children:e.jsx(le,{className:"w-4 h-4"})})]})})]},s.id)),r.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-4 py-6 text-muted-foreground",colSpan:3,children:"No tokens yet."})})]})]})}),e.jsx(W,{open:E,onOpenChange:s=>{s||(c(!1),b())},children:e.jsxs(X,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:d?"Edit API Token":"Create API Token"}),e.jsx(se,{children:"Give the token a name and select abilities."})]}),p?e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm",children:"Copy your new token now. You won't see it again!  If you lose it, you can create a new one."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{readOnly:!0,value:p}),e.jsx(i,{variant:"outline",onClick:()=>f(p),children:e.jsx(w,{className:"w-4 h-4"})})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Name"}),e.jsx(u,{value:o,onChange:s=>g(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Abilities"}),e.jsx("div",{className:"flex items-center gap-4",children:["create","read","update","delete"].map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.includes(s),onChange:L=>{L.target.checked?m([...l,s]):m(l.filter(z=>z!==s))}}),s]},s))})]})]}),e.jsxs(te,{children:[e.jsx(i,{variant:"secondary",onClick:()=>c(!1),children:"Close"}),!p&&e.jsx(i,{onClick:H,disabled:!o.trim(),children:d?"Save":"Create"})]})]})}),e.jsx(R,{open:x!==null,onOpenChange:s=>{s||k(null)},children:e.jsxs(U,{children:[e.jsxs(Y,{children:[e.jsx($,{children:"Delete Token"}),e.jsx(q,{children:"Are you sure you want to delete this token? Applications using it will stop working."})]}),e.jsxs(J,{children:[e.jsx(K,{children:"Cancel"}),e.jsx(i,{variant:"destructive",onClick:O,children:"Delete"})]})]})})]})})]})}export{Ve as default};
